extends ../layout

block content
  script
    $(function(){
      var clickItem;

      $('.para-list').each(function(){
        // the para item's height
        var pHeight = $(this).height();
        
        $(this).find('.cn').css('height', pHeight + 'px');
        $(this).find('.ec-divider').css('height', pHeight + 'px');
      });

      $('.btn-save').click(function(){
        // build article object
        var article = {
          enTitle: $('.en-title').text(),
          cnTitle: $('.cn-title').text(),
          url: $('.url').text(),
          abstract: $('.abstract').text(),
          paraList: []
        };

        $('.para-list').each(function(){
          article.paraList.push({
            en: $(this).find('.en').text().trim(),
            cn: $(this).find('.cn').text().trim(),
            type: 'para',
            state: false
          });
        });

        // post
        $.ajax({
          url: '/article/#{article.id}/edit',
          method: 'POST',
          data: {
            article: article
          },
          success: function(data){
            if(data.result === 1){
              alert('saved');
            }
          }
        });
      });

      $('.para-list').each(function(){
        $(this)[0].oncontextmenu = function(e){
          e.preventDefault();
          clickItem = e.target;

          $('.context-menu').css({
            top: e.clientY + 2 + 'px',
            left: e.clientX + 2 + 'px',
            display: 'block'
          });
        }
      });

      $('.context-menu').click(function(e){
        switch(e.target.id){
          // change para type
          case "main-header":
            // todo
            break;
          case "sub-header":
            // todo
            break;
          case "text":
            // todo
            break;
          case "quote":
            // todo
            break;
          case "code":
            // todo
            
            break;
          // add or remove para
          case "add-para":
            alert('s');
            break;
          case "remove-para":
            alert('s');
            break;
        }
      });

      $(document).click(function(){
        $('.context-menu').hide();
      });
    });

  a(href="/article/#{article.id}").back-button.place-right

  div.title
    h2.en-title(contenteditable=true) #{article.enTitle}
    h2.title-divider /
    h2.cn-title(contenteditable=true, placeholder="中文标题") #{article.cnTitle}
  
  div.url-wap
    span.label.warning 链接
    span.url(contenteditable=true) #{article.url}

  div.abstract-wap
    span.label.warning 摘要
    span.abstract(contenteditable=true) #{article.abstract}

  each p in article.paraList
    div.para-list
      div.en(contenteditable=true) #{p.en}
      div.ec-divider
      div.cn(contenteditable=true) #{p.cn}

  button.btn-save.place-right
    i.icon-save
    | 保存

  //- button.btn-save.place-rightmenu
  //-   i.icon-save
  //-   | 浏览

  ul.context-menu
    li 格式
      span.arrow
      ul.sub-menu
        li#main-header 主标题
        li#sub-header 子标题
        li#text 正文
        li#quote 引用
        li#code 代码 
    li#add-para 增加段落
    li#remove-para 删除段落




      
